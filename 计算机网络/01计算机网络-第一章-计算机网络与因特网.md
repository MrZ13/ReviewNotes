[TOC]

# Chap1 介绍

## 1.0 名词介绍

> LAN 局域网	WAN 广域网	Router 路由器	
>
> Switch 交换机 Protocol 交换机	Packet 数据包/报文/分组
>
> ISP 因特网服务提供商	TCP 传输控制协议 UDP 用户数据包协议
>
> Intranet 内网 Extranet 外网 Bandwidth 带宽
>
> Infrastucture 基础设施 Ethernet 以太网 Multiplexing 多路复用
>
> Encapsulation 封装	Stack 栈	FDM 频分复用
>
> TDM 时分复用 Congestion 拥塞



## 1.1 什么是因特网

### 1.1.1 计算机网络的定义

> 一系列为了共享数据、资源，以及通信，所以通过电信系统连接起来的多个计算机



###### 维基百科定义

> A computer network or data network is a digital telecommunications network which allows nodes to share resources. In computer networks, networked computing devices exchange data with each other using a
> data link



### 1.1.2 计算机网络的构成

###### 硬件

> - 终端系统：大型机、PC、客户端(各种程序)、工作站、服务器......
> - 中间系统：交换机、路由器、......
> - 接口：网络接口卡(NIC)、Modem
> - 媒介：双绞线、同轴电缆、光纤、无线、......



###### 软件

> - 协议：CSMA/CD,TCP/IP,UDP,PPP,ATM......
> - 应用：HTTP,SMTP,FTP,Telnet......



### 1.1.3 计算机网络的应用

###### 资源共享

- 硬件资源：打印机、磁盘、......
- 软件资源：不同的软件



###### 信息共享

- www万维网
- 在不同地点的资源共享



###### 交流

- email
- 信息广播



###### 普适计算



###### 移动用户

- 802.11热点
- 3g,4g,5g,.....
- wearable compter



### 1.1.4 网络的分类

#### 1.1.4.1 根据拓扑结构分类

> 1. 总线拓扑
>
>    所有的设备通过一个共用的总线进行链接
>
>    ![dGaJAI.jpg](https://s1.ax1x.com/2020/08/20/dGaJAI.jpg)
>
> 2. 环状拓扑
>
>    一个帧在环中进行传递，每到一个节点会停下来。如果该节点需要传递信息，则将会把数据存入这个帧中
>
>    ![dGaU9f.jpg](https://s1.ax1x.com/2020/08/20/dGaU9f.jpg)
>
> 3. 星形拓扑
>
>    以太局域网中最常见的拓扑结构
>
>    ![dGaYNt.jpg](https://s1.ax1x.com/2020/08/20/dGaYNt.jpg)
>
> 4. 扩展的星形拓扑
>
>    ![dGat4P.jpg](https://s1.ax1x.com/2020/08/20/dGat4P.jpg)
>
> 5. 网状结构
>
>    不同节点之间两两链接到一起
>
>    ![dGadgS.jpg](https://s1.ax1x.com/2020/08/20/dGadgS.jpg)



#### 1.1.4.2 根据范围分类

> 1. LAN(Local Area Network)
>
>    多个地理上相邻的计算机通过有线/无线的方式进行连接
>
> 2. WAN(Wide Area Network)
>
>    比LAN的范围更大的网络
>
> 3. Internet
>
>    "网络的网络"，一个世界范围的网络



#### 1.1.4.3 根据边界分类

> 1. Intranet(内网)
>
>    常用于企业内部的小型网络,可能包括了多个LAN
>
> 2. Extranet(外网)
>
>    外网可以理解为内网的一部分。外网采用互联网技术和公共电信网络，可以被外界用户广泛地使用



### 1.1.5 什么是互联网(Internet)?

#### 1.1.5.1 “螺母与螺栓”视角

- 无数相连的计算设备
- 运行着的网络应用
- 通信链接
- 路由器负责转发packet
- 协议控制信息的发送和接收
- Internet是"网络的网络"，有着"松散的分层"



#### 1.1.5.2 网络结构视角

- 网络核心
  - 相连的路由器
  - 网络的网络
- 网络边缘
  - 应用
  - 终端
- 存取网络与物理媒介
  - 有线和无线的通信链接



#### 1.1.5.3 服务视角

- 通信基础设施支持了分布在不同区域的应用
- 通信服务被提供给应用
  - 无连接的服务
  - 面向连接的服务



### 1.1.6 什么是协议

> 协议定义了网络中实体传输数据的格式、次序，以及传输或接收数据的动作



## 1.2 因特网的历史

1961-1972 早期的分组交换概念出现

1972-1980 网络互联，新型的、专有的网络

1980-1990 新的协议与网络的扩散

1990-2005 商业化的发展，Web，APP

2005-- 



## 1.3 网络边缘

### 1.3.1 网络核心与网络边缘

- 网络核心
  - 相连的路由器
  - 网络的网络
- 网络边缘
  - 应用
  - 终端
- 存取网络与物理媒介
  - 有线和无线的通信链接



### 1.3.2 不同的模型

#### 1.3.2.1 用户/服务器模型

> 用户主机进行请求，并接收从服务器发回的消息



#### 1.3.2.2 p2p模型

> 使用专用服务器最少的模型，用户主机之间进行连接



### 1.3.3 网络边缘提供的服务

#### 1.3.3.1 面向连接的服务

###### 链接

> 终端设备通过使用协议建立的逻辑或物理连接。面向连接的协议通过下面三个步骤提供连接服务：
>
> - 握手建立连接
> - 数据传输
> - 销毁连接



关于面向连接的服务的重点内容：TCP协议(将在第三章中详细介绍)

> 使用TCP的应用
>
> - HTTP
> - FTP
> - Telnet
> - SMTP
> - ...



#### 1.3.3.2 无链接的服务

> - 数据传输前无需建立任何连接的服务
> - 一个设备可以任意地向其他设备发送消息
> - 无链接的服务==不保证==可靠的数据传输



无连接服务的代表协议：UDP

> 使用UDP的应用
>
> - 流媒体传输
> - DNS
> - QQ
> - ......



## 1.4 网络核心

> 互相连接的路由器构成的Mesh



网络传输数据的两种重要方式：

1. 电路交换(Circuit Switching)

   > 每个请求拥有专属的电路

2. 分组交换(Packet Switching)

   > 数据以块的形式，不连续地在网络中传播



### 1.4.1 电路交换 Circuit Switching

#### 1.4.1.1 概念

> 终端资源为调用保留，在建立连接之后才分配



- 常见的资源有连接带宽、交换容量等
- 资源是专用的，不会共享(指同一个连接上不发送不同的数据，但信道可能会共享)
- 与电路类似，保证连接的质量
- 使用前需要建立连接



#### 1.4.1.2 复用技术

> 由于用于连接的线路资源是有限的，因此需要靠复用来支持更多的并发访问



##### 1.4.1.2.1  FDM 频分多路复用

> 将频率进行分割，提供给不同的连接共享，从而达到复用的效果。
>
> 常见的FDM：FM广播
>
> ![dtECz6.jpg](https://s1.ax1x.com/2020/08/21/dtECz6.jpg)



##### 1.4.1.2.2  TDM 时分多路复用

> 将时间进行分割，每个连接能够使用一小段连续的时间
>
> [![dtEVdH.md.jpg](https://s1.ax1x.com/2020/08/21/dtEVdH.md.jpg)](https://imgchr.com/i/dtEVdH)



TDM对资源的浪费原因：

- 每个用户/终端需要发送数据的时机不一定能和它所分到的时间片段完全重合，因此需要等待
- 而与此同时，此时可以发送数据的用户/终端可能反而不需要发送



##### 1.4.1.2.3  CDMA







### 1.4.2 分组交换 Package Swiching

#### 1.4.2.1 概念 

###### 背景

> 电路交换虽然可靠，但不够灵活，且难以支持多个用户同时的数据发送需求。因此，考虑使用分组交换的方式进行数据传输



###### 做法

> - 将端到端的数据流分为多个块(Packets)
> - 不同的终端可以同时发送packet
> - 每个packet占满带宽
> - 按实际需要使用资源



###### 资源争用相关概念

> - 总的资源需求可以大于实际的系统资源
> - 使用队列保存暂时需要等待的packet
> - 存储并转发：每个packet从一跳转到下一跳，直到到达目的地



[![dtZmxP.md.jpg](https://s1.ax1x.com/2020/08/21/dtZmxP.md.jpg)](https://imgchr.com/i/dtZmxP)



#### 1.4.2.2 复用技术

##### 1.4.2.2.1 统计时分多路复用(STDM: Statistical time division multiplexing)

> 分组交换，实际上就是统计时分多路复用的方法。
>
> 统计时分复用（Statistical Time Division Multiplexing）是一种根据用户实际需要动态分配线路资源的时分复用方法。只有当用户有数据要传输时才给他分配线路资源，当用户暂停发送数据时，不给他分配线路资源，线路的传输能力可以被其他用户使用。采用统计时分复用时，每个用户的数据传输速率可以高于平均速率，最高可达到线路总的传输能力。



#### 1.4.2.3 存储与转发

###### 存储

> 每个packet都需要先到达一个路由器，再前往下一个路由器



###### 转发

> 将packet经由多个路由器传输到目的主机
>
> - packet中存储的目的地信息会决定下一跳路由器的选择
> - 发往同一个目的地的packets的实际路线可能是不同的



Tips：特殊的分组交换网络——类电路交换网络

特点：

- 每个packet携带tag，tag决定了下一跳路由器
- 同一个起始点、终点的packet经过的路径也是一样的
- 路由器会保存每个请求的状态(与普通分组交换的明显不同之处)



### 1.4.3 两种交换方式的对比

#### 1.4.3.1 使用人数的区别

> 在资源同样的条件下，分组交换可以支持更多的用户同时使用



#### 1.4.3.2 适用情况的区别

- 分组交换更适合短时间大量的数据传输需求
  - 资源是共享的
  - 不需要建立连接
- 分组交换更有可能遇到拥塞问题
- 如何让分组交换达到电路交换的可靠程度，时至今日仍然是一个需要研究的问题



### 1.4.3 网络的分类

[![dt3oBn.md.jpg](https://s1.ax1x.com/2020/08/21/dt3oBn.md.jpg)](https://imgchr.com/i/dt3oBn)



## 1.5 存取网络与物理介质

### 1.5.1 背景介绍

> 终端系统想要接入网络，需要依靠网络边缘的路由器。根据场景的不同，主要可以分为三种不同的接入形式：
>
> 1. Residential Access Nets 家庭网络
> 2. Institutional Access Networks 机构网络
> 3. Mobile Access Networks 移动网络



:zap:需要关注的重要问题：

1. 不同存取网络的带宽
2. 网络是共享的还是专用的
3. 从何处可以接入网络
4. 使用哪个ISP



### 1.5.2 不同类型的网络

#### 1.5.2.1 家庭住宅网络

##### 不同的接入方式

1. ###### 拨号上网

   - 最高只有56kbps的速度

   - 无法同时服务网络和电话(连上了就不能打电话)

     

2. ###### ADSL(非对称用户数字电路)

   - 也是使用了现有的电话线路
   - 通过电话线路连接到中央办公室的DSLAM，然后连接到ISP
   - 特点是==上下行速度不一致==

   [![dtwcrT.md.jpg](https://s1.ax1x.com/2020/08/21/dtwcrT.md.jpg)](https://imgchr.com/i/dtwcrT)

   

3. ###### Cabel Modem(电缆调制解调器)

   - 通过电缆和光纤，将家庭和ISP路由器连接起来
   - 常见的做法是，光纤接入居民楼，然后通过传统的同轴电缆接入每一户

   [![dt0TYj.md.jpg](https://s1.ax1x.com/2020/08/21/dt0TYj.md.jpg)](https://imgchr.com/i/dt0TYj)

4. FTTx 技术

   - FTTH Fiber To The Home：光纤入户
   - FTTB Fiber to the building：光纤入楼，然后通过电缆/双绞线分配给用户
   - FTTC Fiber to the Curb：光纤到路边，从路边到用户可以使用星形结构双绞线作为传输媒介



#### 1.5.2.2 机构网络

> 工作机构的网络常常使用LAN(Ethernet)



- 一般在公司、大学等机构使用
- 有10Mbps,100Mbps等多种速率
- 今天的很多终端系统都是连接到以太网交换机上的

[![dtslcR.md.jpg](https://s1.ax1x.com/2020/08/21/dtslcR.md.jpg)](https://imgchr.com/i/dtslcR)



#### 1.5.2.3 移动网络

> 共享的移动网络将终端系统连接到路由器



###### 无线局域网

- 用于建筑内
- 常常体现为802.11的wifi



###### 无线广域网

- 由电信公司提供
- 如3G,4G,......



### 1.5.3 物理媒介

#### 1.5.3.1 相关概念

- Bit：传播信息或数据的单位，1/8 byte
- 物理连接：接收者和发送者之间实际的连接
- 有向导的媒介：如铜线、光纤、电缆等介质，信号在其中有向地传播
- 无向导的媒介：如广播，信号的传播是无特定方向的



#### 1.5.3.2 不同的介质

##### 1.5.3.2.1 双绞线(Twisted Pair)

> 由两根缠绕在一起的绝缘铜线构成

常见的双绞线：

- 3类线：10Mbps
- 5类线：1Gbps
- 6类线：10Gbps

（除此之外，还有超五类线，7类线等其他种类）



##### 1.5.3.2.2 同轴电缆

> 有两个同心导体，而导体和屏蔽层又共用同一轴心的电缆

同轴电缆的信号传输是双向的



##### 1.5.3.2.3 纤维

> 使用玻璃纤维传输光脉冲信号，每个脉冲信号指一位数据

特点：

- 速度快
- 错误率低
- 不受电磁干扰的影响



##### 1.5.3.2.4 广播

> 信号以电磁光谱的形式传播



常见的广播连接类型

> 1. 地面微波 terrestrial microwave
> 2. LAN
> 3. WAN
> 4. 卫星通讯



## 1.6 网络结构与ISP(互联网服务提供者)

> 因特网是“网络的网络”，有"松散的分层"
>
> ISP主要可以分为四类，即Tier-1到Tier-3,以及本地ISP



###### Tier-1 ISP

> 是Internet的中心，提供国家范围/跨国范围的网络服务
>
> e.g. AT&T,MCI......



###### Tier-2 ISP

> Tier-2 ISP的范围比Tier-1 ISP小，通常连接到一个或几个Tier-1 ISP，并于其他Tier-2 ISPs相连



###### Tier-3 ISP,Local ISP

> 最小的ISP，是离终端系统最近的

[![dto3J1.md.jpg](https://s1.ax1x.com/2020/08/21/dto3J1.md.jpg)](https://imgchr.com/i/dto3J1)





## 1.7 分组交换网络的延迟与丢包

### 1.7.1 相关概念

###### Data Rate

> 数据率，主机在数字信道上传输数据的速率，取决于物理介质（一般不是影响延迟的主要因素）



###### BandWidth

> 传输管道中可以传递数据的能力。通常以每秒传送周期或赫兹(Hz)来表示
>
> e.g. 带宽为1Mbps：每秒链路上可以传输1Mb的数据



###### Throughput

> 数据在发送者和接收者之间传输的比率



###### Communication Channel

> 物理的连接，或者逻辑的多路复用的中的一条连接



### 1.7.2 信道的种类

###### 单向

> 信息单向传递，发送端不接收，接收端不发送



###### 半双工

> 信息双向传递，但不能同时



###### 全双工

> 信息可以同时双向传递



### 1.7.3 延迟出现的原因

#### 1.7.3.1 四种类型的延迟

###### 1.Nodal Processing

- 路由器检查错误位
- 路由器确定输出到哪个链接



###### 2.Queueing

- 在ready队列等待发送耗费的时间
- 取决于拥塞的状态



###### 3.Transmission Delay

- TD = L/R
- L：packet的长度
- R：带宽
- 即把数据发送到信道上耗费的时间



###### 4.Propagation Delay

- PD = D/S
- D：物理链接的长度
- S：信号传输的速率，一般来说非常快
- 信号在物理介质上传输花费的时间



#### 1.7.3.2 计算公式

$D_{nodal} = D_{proc}+D_{queue}+D_{trans}+D_{prop}$



#### 1.7.3.3 排队延迟的分析

R：带宽

L：packet长度

a：packet平均到达率



Traffic Intensity(交通强度) = La/R

- TI ~ 0：平均队列长度很小
- TI ~ 1：延迟越来越大(因为难以好转)
- TI > 1：服务速度 < 到达速度，延迟将逐渐增长至无穷大



#### 1.7.3.4 实际中网络延迟的测算

> 采用向目的路由器/主机发送packet，并接收发回的packet，比较时间差来判断延迟	

[![dNCY40.md.jpg](https://s1.ax1x.com/2020/08/21/dNCY40.md.jpg)](https://imgchr.com/i/dNCY40)



### 1.7.4 丢包出现的原因

当packet到达路由器的速率过高，使得路由器上的queue放满后，新来的packet将会被抛弃



Tips:被抛弃的packet可能由上一个节点重传，可能由发送主机重传，也可能完全不重传



### 1.7.5 吞吐量

数据在sender/receiver之间传输的规模(Bits/time unit)

- 瞬时吞吐量：瞬间的比值
- 平均吞吐量：长期的平均比值



Tips：端到端吞吐量的值取决于整个连接中的最低值





## 1.8 协议的层次，服务的模型

:zap:协议的三个关键要素：

- 语法：确定通信双方"如何讲",定义了数据格式,编码和信号电平等
- 语义：确定通信双方"讲什么",定义了用于协调同步和差错处理等控制信息
- 同步：确定通信双方"讲话的次序",定义了速度匹配和排序等.



### 1.8.1 协议分层的背景

> 要想保证信息和数据的正确传输，需要解决很多事情
>
> - 激活链接的信号
> - 寻找接收者
> - 确定接收者的状态
> - ......

因此，希望能够将网络有序地组织起来，能够达到上层直接使用下层服务，而不关心实现细节的目的。



### 1.8.2 为什么需要分层

#### 1.8.2.1 分层的好处

- 各层之间独立，问题被分为多个子问题
- 灵活性好，一层的变化不会影响其他层
- 机构上能够分割开
- 易于实现和维护
- 能够促进标准化的工作



#### 1.8.2.2 每层的工作(不一定每层会做所有的工作)

- 差错控制
- 流量控制
- 分段与重装
- 复用与分用
- 连接建立与连接释放



### :fire:1.8.3 ISO:OSI(7) VS TCP/IP(5)

#### 1.8.3.1 ISO:OSI 

> 国际标准化组织，开放系统互连基本参考模型
>
> ![dGHS1K.jpg](https://s1.ax1x.com/2020/08/20/dGHS1K.jpg)

ISO:OSI中，会话层和表示层的作用一直以来不够明确，因此实际开放中使用了更简洁的TCP/IP五层协议



#### 1.8.3.2 TCP/IP

> 由工业界推动的标准
>
> ![dGbea9.jpg](https://s1.ax1x.com/2020/08/20/dGbea9.jpg)	



### 1.8.4 互联网协议栈

#### 1.8.4.1 应用层协议

> 应用层：支持各种网络应用

- FTP File Transfer Protocol
- SMTP:Simple Mail Transfer Protocol
- HTTP:Hypertext Transger Protocol 
- POP3:Post Office Protocol

#### 1.8.4.2 传输层协议

> 从主机到主机的数据传输

- TDP Transmission Control Protocol

- UDP User Datagram Protocol

  

#### 1.8.4.3 网络层协议

> 从发送地到目的地的datagram寻路

- IP
- Routing Protocols
- ICMP
- IGMP
- RIP



#### 1.8.4.4 链路层协议

> 两个相邻网络构件之间的数据传输

- PPP
- Ethernet



#### 1.8.4.5 物理层协议

> 实际的物理链路，光纤、双绞线......，无协议



![dYRXfU.jpg](https://s1.ax1x.com/2020/08/21/dYRXfU.jpg)



### :fire:1.8.5 PDUS of TCP/IP

> 每个层次上传输的数据类型

- 应用层：Message（报文）
- 传输层：Datagram（数据报）/Segment（报文段）
- 网络层：Packet（分组）/Datagram（数据包）
- 链接层：Frame（帧）
- 物理层：Bit



### 1.8.6 TCP/IP Protocol Suite

Suite:Big Family With Many Members

![dYW0A0.jpg](https://s1.ax1x.com/2020/08/21/dYW0A0.jpg)



### 1.8.7 实体，协议，服务和服务访问点

###### 实体

> 任何可发送或接收信息的硬件或软件进程



###### 协议

> 控制两个==对等实体==进行通信的规则的集合



###### 服务

> 下层向上层提供的功能



###### 服务访问点

> 同一系统相邻两层实体进行交互的地方，称为服务访问点SAP(Service Access Point)



- 在协议的控制下，两个对等实体间的通信使得本层能够向上一层提供服务。
- 要实现本层协议，还需要使用下层所提供的服务
- 本层的服务用户只能看见服务，而无法看见下层的协议，即协议对上层是透明的
- 协议是=="水平的"==，即在同一层起作用
- 服务是==“垂直的”==，即由下层向上层，以层间接口的形式提供



![dYhSd1.jpg](https://s1.ax1x.com/2020/08/21/dYhSd1.jpg)



## 1.9 网络安全

### 1.9.1 网络安全研究的内容

> 1. 计算机网络如何被攻击
> 2. 如何抵御攻击
> 3. 如何设计出能够免疫攻击的架构



Tips: Internet一开始并未考虑过多的安全因素，因为并非一开始就想要大规模使用的



### 1.9.2 恶意软件的介绍

- 恶意软件可以通过蠕虫、病毒、木马进入用户主机
- 间谍程序可以检测用户的键盘输入、网页浏览记录，并上传
- 被感染的主机往往会被加入僵尸网络，被黑客用于DDoS攻击或发送垃圾邮件
- 恶意软件往往具有自复制性



### 1.9.3 三种常见的恶意程序

#### 1.9.3.1 病毒

- 需要一定程度上的用户交互
- 具有自复制性



#### 1.9.3.2 蠕虫

- 不需要任何交互的恶意程序
- 具有自复制性



#### 1.9.3.3 木马

- 隐藏在有用的程序中



### 1.9.4 其他相关概念

#### 1.9.4.1 DDoS攻击

> 通过短时间内大量发送请求，使得服务器无法承受负载而崩溃



#### 1.9.4.2 包嗅探(Packet Sniffing)

- 前提是介质是广播的(无线网、共享以太网......)
- 读取所有经过的packet



#### 1.9.4.3 IP嗅探(IP Sniffint)

- 获取其他主机的ip地址
- 伪装成其他主机，发送packet



#### 1.9.4.4 记录与回放

- 嗅探敏感信息(用户名、密码)
- 以他人身份登陆后进行操作